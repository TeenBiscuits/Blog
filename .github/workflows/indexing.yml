name: üîé Indexaci√≥n en motores de b√∫squeda

on:
  push:
    branches: ['main']
  workflow_dispatch:

jobs:
  wait-for-vercel-deployment:
    name: üîº Esperar el deploy en Vercel
    if: github.repository == 'TeenBiscuits/Blog'
    runs-on: ubuntu-latest
    steps:
      - name: ‚åõ Espera 50s
        run: sleep 50s
        shell: bash
      - name: ‚åõ Esperar deploy
        # tj-actions
        # MIT
        # https://github.com/tj-actions/vercel-wait
        uses: tj-actions/vercel-wait@v1.2.2
        with:
          project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          token: ${{ secrets.VERCEL_TOKEN }}
          sha: ${{ github.sha }}

  indexnow:
    name: üîé Bing IndexNow
    if: github.repository == 'TeenBiscuits/Blog'
    needs: [wait-for-vercel-deployment]
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨ÜÔ∏è Subir Sitemap
        # Bojie Yang
        # MIT
        # https://github.com/bojieyang/indexnow-action
        uses: bojieyang/indexnow-action@v2.1.0
        with:
          sitemap-location: 'https://blog.pablopl.dev/sitemap-index.xml'
          key: ${{ secrets.INDEXNOW_KEY }}
          #lastmod-required: 'true'
          endpoint: www.bing.com
          failure-strategy: error

  google-indexing:
    name: üîé Google Index
    if: github.repository == 'TeenBiscuits/Blog'
    needs: [wait-for-vercel-deployment]
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨ÜÔ∏è Subir Urls
        # Robin Genz
        # MIT
        # https://github.com/robingenz/google-indexing-action
        uses: robingenz/action-google-indexing@v1.0.2
        with:
          siteUrl: 'blog.pablopl.dev'
          gcpServiceAccountKey: ${{ secrets.GCP_SA_KEY }}
