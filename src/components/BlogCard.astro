---
import FormattedDate from './FormattedDate.astro'
import type { ImageMetadata } from 'astro'
import { Picture } from 'astro:assets'
import { type Lang } from '@/i18n'

const { post } = Astro.props

const blogImages = import.meta.glob<{ default: ImageMetadata }>(
	'/src/assets/blogimages/**/*.{jpeg,jpg,png,gif}'
)

const locale = Astro.currentLocale as Lang
const [, ...id] = post.id.split('/')
const coverImagePath = `/src/assets/blogimages/${post.data.pubId}/cover.jpg`
---

<a
	transition:name={`blog-card-${post.data.pubId}`}
	href={`/${locale}/posts/${id}/`}
	class="group hover:bg-secondary dark:hover:bg-secondary-dark flex h-full flex-col gap-4 rounded-3xl p-3 pb-8 transition-colors"
>
	{
		blogImages[coverImagePath] && (
			<div class="relative overflow-hidden rounded-xl">
				<Picture
					src={blogImages[coverImagePath]()}
					alt={post.data.title}
					widths={[280, 400, 565]}
					formats={['avif', 'webp', 'jpg']}
					priority
					layout="constrained"
					class="relative aspect-video object-cover transition-transform duration-200 group-hover:scale-110"
					transition:name={`blog-cover-${post.data.pubId}`}
				/>
			</div>
		)
	}
	<h3
		class="text-2xl font-semibold transition-colors"
		transition:name={`blog-title-${post.data.pubId}`}
	>
		{post.data.title}
	</h3>
	<p class="line-clamp-3 opacity-80">
		{post.data.description}
	</p>
	<p class="mt-auto text-sm tracking-tight uppercase">
		<FormattedDate date={post.data.pubDate} />
	</p>
</a>
